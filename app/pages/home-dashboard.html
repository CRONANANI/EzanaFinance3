<!-- Import Home Dashboard Component Styles -->
<link rel="stylesheet" href="components/home-dashboard/portfolio-detail-cards.css">
<link rel="stylesheet" href="components/home-dashboard/asset-allocation-card.css">
<link rel="stylesheet" href="components/home-dashboard/transactions-and-actions.css">

<!-- Import Home Dashboard Component Scripts -->
<script src="components/home-dashboard/recent-transactions.js"></script>
<script src="components/home-dashboard/quick-actions.js"></script>

<!-- Top Navigation -->
<nav id="topnav" class="fixed top-0 left-0 right-0 z-40 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 shadow-lg transition-all duration-300 ease-in-out">
    <div class="flex items-center justify-between px-6 py-4 max-w-6xl mx-auto w-full">
        <!-- Logo/Brand -->
        <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                <i class="bi bi-tree text-white text-lg"></i>
            </div>
            <span class="text-lg font-bold text-gray-900 dark:text-white">Ezana Finance</span>
        </div>

        <!-- Navigation Menu -->
        <div class="hidden md:flex items-center space-x-6">
            <!-- Dashboard -->
            <button onclick="switchTab('home')" class="flex items-center space-x-2 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200" id="topnav-home">
                <i class="bi bi-house-door"></i>
                <span>Dashboard</span>
            </button>

            <!-- Research Tools Dropdown -->
            <div class="relative group">
                <button class="flex items-center space-x-2 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200">
                    <i class="bi bi-search"></i>
                    <span>Research Tools</span>
                    <i class="bi bi-chevron-down text-sm"></i>
                </button>
                <div class="absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                    <div class="py-2">
                        <button onclick="switchTab('inside-the-capitol')" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                            <i class="bi bi-building text-sm mr-2"></i>
                            Inside the Capitol
                        </button>
                        <button onclick="switchTab('market-analysis')" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                            Market Analysis
                        </button>
                        <button onclick="switchTab('company-research')" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                            <i class="bi bi-building text-sm mr-2"></i>
                            Company Research
                        </button>
                        <button onclick="switchTab('economic-indicators')" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                            <i class="bi bi-graph-up-arrow text-sm mr-2"></i>
                            Economic Indicators
                        </button>
                        <button onclick="switchTab('financial-analytics')" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                            <i class="bi bi-graph-up text-sm mr-2"></i>
                            Financial Analytics
                        </button>
                    </div>
                </div>
            </div>

            <!-- Watchlist -->
            <button onclick="switchTab('watchlists')" class="flex items-center space-x-2 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200" id="topnav-watchlists">
                <i class="bi bi-bookmark-star"></i>
                <span>Watchlist</span>
            </button>

            <!-- Community -->
            <button onclick="switchTab('community')" class="flex items-center space-x-2 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200" id="topnav-community">
                <i class="bi bi-people"></i>
                <span>Community</span>
            </button>
        </div>

        <!-- Spacer for centering -->
        <div class="hidden md:block w-32"></div>

        <!-- Mobile Menu Toggle -->
        <button class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300" onclick="toggleMobileMenu()">
            <i class="bi bi-list text-xl"></i>
        </button>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="md:hidden hidden bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 space-y-2">
            <!-- Dashboard -->
            <button onclick="switchTab('home')" class="w-full flex items-center space-x-2 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200">
                <i class="bi bi-house-door"></i>
                <span>Dashboard</span>
            </button>

            <!-- Research Tools -->
            <div class="space-y-1">
                <div class="px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400">Research Tools</div>
                <button onclick="switchTab('inside-the-capitol')" class="w-full flex items-center space-x-2 px-6 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200">
                    <i class="bi bi-building text-sm"></i>
                    <span>Inside the Capitol</span>
                </button>
                <button onclick="switchTab('market-analysis')" class="w-full flex items-center space-x-2 px-6 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200">
                    <span>Market Analysis</span>
                </button>
                <button onclick="switchTab('company-research')" class="w-full flex items-center space-x-2 px-6 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200">
                    <i class="bi bi-building text-sm"></i>
                    <span>Company Research</span>
                </button>
                <button onclick="switchTab('economic-indicators')" class="w-full flex items-center space-x-2 px-6 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200">
                    <i class="bi bi-graph-up-arrow text-sm"></i>
                    <span>Economic Indicators</span>
                </button>
                <button onclick="switchTab('financial-analytics')" class="w-full flex items-center space-x-2 px-6 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200">
                    <i class="bi bi-graph-up text-sm"></i>
                    <span>Financial Analytics</span>
                </button>
            </div>

            <!-- Watchlist -->
            <button onclick="switchTab('watchlists')" class="w-full flex items-center space-x-2 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200">
                <i class="bi bi-bookmark-star"></i>
                <span>Watchlist</span>
            </button>

            <!-- Community -->
            <button onclick="switchTab('community')" class="w-full flex items-center space-x-2 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-all duration-200">
                <i class="bi bi-people"></i>
                <span>Community</span>
            </button>
        </div>
    </div>
</nav>

<div class="main-content" style="margin-top: 80px;">
<div class="container mx-auto px-6 py-12">
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-4xl font-light text-foreground tracking-tight page-title-shiny">Portfolio Dashboard</h1>
            <p class="text-muted-foreground mt-2 text-lg">Track your investments and financial performance</p>
        </div>
        <div class="flex items-center space-x-4">
            <button onclick="refreshPortfolioData()" class="px-5 py-2.5 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-opacity-90 transition-all duration-300 shadow-lg">
                <i class="bi bi-arrow-clockwise mr-2"></i>Refresh
            </button>
            <div class="text-sm text-muted-foreground">
                Last updated: <span id="portfolio-last-updated" class="text-foreground">Just now</span>
            </div>
        </div>
    </div>


    <!-- Main Dashboard Layout -->
    <div class="dashboard-main-layout">
        <!-- Main Portfolio Card - Takes remaining space -->
        <div class="main-portfolio-card" id="main-portfolio-card">
            <!-- Total Portfolio Value Card - Expanded by Default -->
            <div class="portfolio-detail-card total-portfolio expandable-portfolio expanded" data-card-type="total-portfolio" onclick="expandCard(this)">
                <div class="card-header">
                    <h3 class="card-title">Total Portfolio Value</h3>
                    <div class="card-icon">
                        <i class="bi bi-wallet2"></i>
                    </div>
                </div>
                <div class="card-value">$127,843.52</div>
                <div class="card-change positive">
                    <i class="bi bi-arrow-up"></i>
                    +$2,847.31 (+2.28%)
                </div>
                <div class="card-description">Updated 2 minutes ago</div>
                
                <!-- Portfolio Chart Content - Visible by Default -->
                <div class="portfolio-chart-content expanded" id="portfolio-chart-content">
                    <div class="portfolio-chart-controls">
                        <div class="time-period-selector">
                            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Time Period:</label>
                            <select id="portfolio-time-period" onchange="updatePortfolioChart()" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 dark:bg-gray-700 dark:text-gray-200">
                                <option value="1">1 Month</option>
                                <option value="3">3 Months</option>
                                <option value="6">6 Months</option>
                                <option value="12" selected>1 Year</option>
                                <option value="60">5 Years</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                    </div>
                    
                    
                    <div class="portfolio-chart-container mt-4">
                        <canvas id="portfolio-chart" width="1200" height="800"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Component Cards - Vertical column on the right -->
        <div class="horizontal-cards-container">
        <!-- Today's Gain/Loss Card -->
        <div class="portfolio-detail-card todays-pnl square-card" data-card-type="todays-pnl" onclick="expandCard(this)">
            <div class="card-header">
                <h3 class="card-title">Today's P&L</h3>
                <div class="card-icon">
                    <i class="bi bi-graph-up-arrow"></i>
                </div>
            </div>
            <div class="card-value">+$847.31</div>
            <div class="card-change positive">
                <i class="bi bi-arrow-up"></i>
                +0.67%
            </div>
            <div class="card-description">Market hours performance</div>
        </div>

        <!-- Top Performer Card -->
        <div class="portfolio-detail-card top-performer square-card" data-card-type="top-performer" onclick="expandCard(this)">
            <div class="card-header">
                <h3 class="card-title">Top Performer</h3>
                <div class="card-icon">
                    <i class="bi bi-star-fill"></i>
                </div>
            </div>
            <div class="card-value">TSLA</div>
            <div class="card-change positive">
                <i class="bi bi-arrow-up"></i>
                +$156.42 (+8.45%)
            </div>
            <div class="card-description">Tesla Inc. - 15 shares</div>
        </div>

        <!-- Risk Score Card -->
        <div class="portfolio-detail-card risk-score square-card" data-card-type="risk-score" onclick="expandCard(this)">
            <div class="card-header">
                <h3 class="card-title">Risk Score</h3>
                <div class="card-icon">
                    <i class="bi bi-shield-check"></i>
                </div>
            </div>
            <div class="card-value">7.2/10</div>
            <div class="card-change negative">
                <i class="bi bi-arrow-down"></i>
                -0.3 from last week
            </div>
            <div class="card-description">Moderate risk profile</div>
        </div>

        <!-- Dividend Income Card -->
        <div class="portfolio-detail-card dividend-income square-card" data-card-type="dividend-income" onclick="expandCard(this)">
            <div class="card-header">
                <h3 class="card-title">Monthly Dividends</h3>
                <div class="card-icon">
                    <i class="bi bi-cash-coin"></i>
                </div>
            </div>
            <div class="card-value">$342.18</div>
            <div class="card-change positive">
                <i class="bi bi-arrow-up"></i>
                +$28.45 (+9.07%)
            </div>
            <div class="card-description">Next payment: March 15</div>
        </div>

        <!-- Market Performance Card -->
        <div class="portfolio-detail-card market-performance square-card" data-card-type="market-performance" onclick="expandCard(this)">
            <div class="card-header">
                <h3 class="card-title">Market Performance</h3>
                <div class="card-icon">
                    <i class="bi bi-graph-up"></i>
                </div>
            </div>
            <div class="card-value">S&P 500</div>
            <div class="card-change positive">
                <i class="bi bi-arrow-up"></i>
                +1.24% today
            </div>
            <div class="card-description">4,567.89 (+56.78)</div>
        </div>

        <!-- Asset Allocation Card -->
        <div class="portfolio-detail-card asset-allocation square-card" data-card-type="asset-allocation" onclick="expandCard(this)">
            <div class="card-header">
                <h3 class="card-title">Asset Allocation</h3>
                <div class="card-icon">
                    <i class="bi bi-pie-chart"></i>
                </div>
            </div>
            <div class="card-value">Diversified</div>
            <div class="card-change positive">
                <i class="bi bi-check-circle"></i>
                Well balanced
            </div>
            <div class="card-description">Stocks: 65% | Bonds: 20% | Cash: 15%</div>
        </div>
        </div>
    </div>

    <script>
        // Card expansion functionality
        function expandCard(clickedCard) {
            const mainCard = document.getElementById('main-portfolio-card');
            const allCards = document.querySelectorAll('.portfolio-detail-card');
            
            // Remove expanded class from all cards
            allCards.forEach(card => {
                card.classList.remove('expanded');
                const chartContent = card.querySelector('.portfolio-chart-content');
                if (chartContent) {
                    chartContent.classList.remove('expanded');
                    chartContent.classList.add('hidden');
                }
            });
            
            // Move clicked card to main position
            const cardClone = clickedCard.cloneNode(true);
            cardClone.classList.add('expanded');
            cardClone.onclick = function() { expandCard(this); };
            
            // Add chart content if it's the portfolio card
            if (clickedCard.dataset.cardType === 'total-portfolio') {
                const chartContent = document.createElement('div');
                chartContent.className = 'portfolio-chart-content expanded';
                chartContent.innerHTML = `
                    <div class="portfolio-chart-controls">
                        <div class="time-period-selector">
                            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Time Period:</label>
                            <select id="portfolio-time-period" onchange="updatePortfolioChart()" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 dark:bg-gray-700 dark:text-gray-200">
                                <option value="1">1 Month</option>
                                <option value="3">3 Months</option>
                                <option value="6">6 Months</option>
                                <option value="12" selected>1 Year</option>
                                <option value="60">5 Years</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                    </div>
                    <div class="portfolio-chart-container mt-4">
                        <canvas id="portfolio-chart" width="1200" height="800"></canvas>
                    </div>
                `;
                cardClone.appendChild(chartContent);
            }
            
            // Add chart content if it's the asset allocation card
            if (clickedCard.dataset.cardType === 'asset-allocation') {
                const chartContent = document.createElement('div');
                chartContent.className = 'portfolio-chart-content expanded';
                chartContent.innerHTML = `
                <div class="chart-controls">
                    <div class="breakdown-selector">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Breakdown Type:</label>
                        <select id="breakdown-type" onchange="updateAssetAllocationChart()" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 dark:bg-gray-700 dark:text-gray-200">
                            <option value="asset-class" selected>Asset Class</option>
                            <option value="sector">Sector</option>
                            <option value="performance">Performance</option>
                        </select>
                    </div>
                </div>
                    <div class="chart-and-insights-container mt-4">
                    <div class="asset-allocation-chart-container">
                            <canvas id="asset-allocation-chart" width="1200" height="400"></canvas>
                    </div>
                    <div class="insights-container">
                        <h4 class="insights-title">Market Insights & Analysis</h4>
                        <div class="insights-content">
                            <div class="chart-summary">
                                <h5 class="summary-title">Chart Summary</h5>
                                <p id="chart-summary-text" class="summary-text">Your portfolio shows a balanced allocation with strong diversification across asset classes.</p>
                            </div>
                            <div class="market-news">
                                <h5 class="news-title">Recent Market News</h5>
                                <div id="market-news-content" class="news-content">
                                    <div class="news-item">Federal Reserve maintains interest rates, supporting equity markets</div>
                                    <div class="news-item">Tech sector shows resilience amid market volatility</div>
                                    <div class="news-item">Energy stocks outperform as oil prices stabilize</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
                cardClone.appendChild(chartContent);
            }
            
            // Replace main card content
            mainCard.innerHTML = '';
            mainCard.appendChild(cardClone);
            
            // Move previous main card to horizontal row
            const horizontalContainer = document.querySelector('.horizontal-cards-container');
            const previousMainCard = document.querySelector('.portfolio-detail-card.expanded');
            if (previousMainCard && previousMainCard !== clickedCard) {
                previousMainCard.classList.remove('expanded');
                previousMainCard.classList.add('square-card');
                previousMainCard.onclick = function() { expandCard(this); };
                horizontalContainer.appendChild(previousMainCard);
            }
            
            // Initialize chart if needed
            if (clickedCard.dataset.cardType === 'total-portfolio' && typeof updatePortfolioChart === 'function') {
                setTimeout(() => updatePortfolioChart(), 100);
            }
            
            if (clickedCard.dataset.cardType === 'asset-allocation' && typeof updateAssetAllocationChart === 'function') {
                setTimeout(() => updateAssetAllocationChart(), 100);
            }
        }
        
        // Initialize portfolio chart when page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof updatePortfolioChart === 'function') {
                updatePortfolioChart();
            }
        });
    </script>


    </div>

    <!-- Recent Transactions Section -->
    <div id="recent-transactions-container">
        <!-- Component will be loaded here -->
    </div>

    <!-- Quick Actions Section -->
    <div id="quick-actions-container">
        <!-- Component will be loaded here -->
    </div>
</div>
</div> <!-- Close main-content -->

<script>
// Mobile menu toggle for top navigation
function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobile-menu');
    if (mobileMenu) {
        mobileMenu.classList.toggle('hidden');
    }
}

// Initialize top navigation positioning when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Highlight the home tab as active when on home-dashboard page
    const homeTab = document.getElementById('topnav-home');
    if (homeTab) {
        homeTab.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-800', 'text-gray-700', 'dark:text-gray-300');
        homeTab.classList.add('bg-amber-50', 'dark:bg-amber-900/20', 'border-amber-200', 'dark:border-amber-800', 'text-amber-700', 'dark:text-amber-300');
    }
    
    // Load component HTML
    loadComponents();
});

// Function to load component HTML
async function loadComponents() {
    try {
        // Load Recent Transactions component
        const transactionsResponse = await fetch('components/home-dashboard/recent-transactions.html');
        if (transactionsResponse.ok) {
            const transactionsHTML = await transactionsResponse.text();
            const transactionsContainer = document.getElementById('recent-transactions-container');
            if (transactionsContainer) {
                transactionsContainer.innerHTML = transactionsHTML;
            }
        }
        
        // Load Quick Actions component
        const actionsResponse = await fetch('components/home-dashboard/quick-actions.html');
        if (actionsResponse.ok) {
            const actionsHTML = await actionsResponse.text();
            const actionsContainer = document.getElementById('quick-actions-container');
            if (actionsContainer) {
                actionsContainer.innerHTML = actionsHTML;
            }
        }
    } catch (error) {
        console.error('Error loading components:', error);
        // Fallback: show inline content if fetch fails
        loadFallbackComponents();
    }
}

// Fallback function to load inline components if fetch fails
function loadFallbackComponents() {
    const transactionsContainer = document.getElementById('recent-transactions-container');
    const actionsContainer = document.getElementById('quick-actions-container');
    
    if (transactionsContainer) {
        transactionsContainer.innerHTML = `
            <div class="recent-transactions-section">
                <div class="transactions-header">
                    <h2 class="transactions-title">Recent Transactions</h2>
                    <button class="view-all-button">View All</button>
                </div>
                <div class="transactions-table">
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-icon buy">
                                <i class="bi bi-arrow-up"></i>
                            </div>
                            <div class="transaction-details">
                                <h4>AAPL Purchase</h4>
                                <p>Apple Inc. • 10 shares</p>
                            </div>
                        </div>
                        <div class="transaction-value">
                            <div class="transaction-amount">$1,750.00</div>
                            <div class="transaction-time">2 hours ago</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    if (actionsContainer) {
        actionsContainer.innerHTML = `
            <div class="quick-actions-section">
                <h2 class="quick-actions-title">Quick Actions</h2>
                <div class="quick-actions-grid">
                    <button class="quick-action-button add-investment">
                        <div class="quick-action-content">
                            <div class="quick-action-icon">
                                <i class="bi bi-plus"></i>
                            </div>
                            <span class="quick-action-title">Add Investment</span>
                        </div>
                    </button>
                    <button class="quick-action-button view-analytics">
                        <div class="quick-action-content">
                            <div class="quick-action-icon">
                                <i class="bi bi-graph-up"></i>
                            </div>
                            <span class="quick-action-title">View Analytics</span>
                        </div>
                    </button>
                    <button class="quick-action-button settings">
                        <div class="quick-action-content">
                            <div class="quick-action-icon">
                                <i class="bi bi-gear"></i>
                            </div>
                            <span class="quick-action-title">Settings</span>
                        </div>
                    </button>
                    <button onclick="switchTab('inside-the-capitol')" class="quick-action-button capitol-insights">
                        <div class="quick-action-content">
                            <div class="quick-action-icon">
                                <i class="bi bi-building"></i>
                            </div>
                            <span class="quick-action-title">Capitol Insights</span>
                        </div>
                    </button>
                </div>
            </div>
        `;
    }
}

</script>
